spec:
  inputs:
    job-subname:
      type: string
    job-needs:
      type: array
      default: []
    job-stage:
      type: string
      default: check
    job-image:
      type: string
    cargo-args:
      type: string
      default: ''

---

lint:$[[ inputs.job-subname ]]:
  needs: $[[ inputs.job-needs ]]
  stage: $[[ inputs.job-stage ]]
  image: $[[ inputs.job-image ]]
  script:
    - time cargo clippy --release --examples --tests $[[ inputs.cargo-args ]]

test:$[[ inputs.job-subname ]]:
  needs: $[[ inputs.job-needs ]]
  stage: $[[ inputs.job-stage ]]
  image: $[[ inputs.job-image ]]
  script:
    - time cargo nextest run --release --profile=ci $[[ inputs.cargo-args ]]
  artifacts:
    paths:
      - target/nextest/ci/junit.xml
    reports:
      junit: target/nextest/ci/junit.xml
